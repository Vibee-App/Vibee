import { __esDecorate, __runInitializers, __setFunctionName } from "tslib";
/*
// Copyright 2024 The Lynx Authors. All rights reserved.
// Licensed under the Apache License Version 2.0 that can be found in the
// LICENSE file in the root directory of this source tree.
*/
import { bindToStyle, genDomGetter, registerAttributeHandler, } from '@lynx-js/web-elements-reactive';
import { commonComponentEventSetting } from '../common/commonEventInitConfiguration.js';
import { bindToIntersectionObserver } from '../common/bindToIntersectionObserver.js';
import { useScrollEnd } from '../common/constants.js';
let ScrollViewEvents = (() => {
    let _instanceExtraInitializers = [];
    let _private_updateUpperIntersectionObserver_decorators;
    let _private_updateUpperIntersectionObserver_initializers = [];
    let _private_updateUpperIntersectionObserver_extraInitializers = [];
    let _private_updateLowerIntersectionObserver_decorators;
    let _private_updateLowerIntersectionObserver_initializers = [];
    let _private_updateLowerIntersectionObserver_extraInitializers = [];
    let _private_updateUpperThreshold_decorators;
    let _private_updateUpperThreshold_initializers = [];
    let _private_updateUpperThreshold_extraInitializers = [];
    let _private_updateLowerThreshold_decorators;
    let _private_updateLowerThreshold_initializers = [];
    let _private_updateLowerThreshold_extraInitializers = [];
    let _private_handleScrollEventsSwitches_decorators;
    let _private_handleScrollEventsSwitches_descriptor;
    return class ScrollViewEvents {
        static {
            const _metadata = typeof Symbol === "function" && Symbol.metadata ? Object.create(null) : void 0;
            _private_updateUpperIntersectionObserver_decorators = [registerAttributeHandler('x-enable-scrolltoupper-event', true)];
            _private_updateLowerIntersectionObserver_decorators = [registerAttributeHandler('x-enable-scrolltolower-event', true)];
            _private_updateUpperThreshold_decorators = [registerAttributeHandler('upper-threshold', true)];
            _private_updateLowerThreshold_decorators = [registerAttributeHandler('lower-threshold', true)];
            _private_handleScrollEventsSwitches_decorators = [registerAttributeHandler('x-enable-scroll-event', true), registerAttributeHandler('x-enable-scrollend-event', true)];
            __esDecorate(this, _private_handleScrollEventsSwitches_descriptor = { value: __setFunctionName(function () {
                    const scroll = this.#dom.getAttribute('x-enable-scroll-event');
                    this.#enableScrollEnd =
                        this.#dom.getAttribute('x-enable-scrollend-event') !== null;
                    if (scroll !== null || this.#enableScrollEnd) {
                        this.#getScrollContainer().addEventListener('scroll', this.#handleScroll);
                        this.#getScrollContainer().addEventListener('scrollend', this.#handleScrollEnd);
                        this.#dom.addEventListener('scroll', this.#handleScroll);
                        this.#dom.addEventListener('scrollend', this.#handleScrollEnd);
                        this.#prevX = 0;
                        this.#prevY = 0;
                    }
                    else {
                        this.#dom.removeEventListener('scroll', this.#handleScroll);
                        this.#dom.removeEventListener('scrollend', this.#handleScrollEnd);
                    }
                }, "#handleScrollEventsSwitches") }, _private_handleScrollEventsSwitches_decorators, { kind: "method", name: "#handleScrollEventsSwitches", static: false, private: true, access: { has: obj => #handleScrollEventsSwitches in obj, get: obj => obj.#handleScrollEventsSwitches }, metadata: _metadata }, null, _instanceExtraInitializers);
            __esDecorate(null, null, _private_updateUpperIntersectionObserver_decorators, { kind: "field", name: "#updateUpperIntersectionObserver", static: false, private: true, access: { has: obj => #updateUpperIntersectionObserver in obj, get: obj => obj.#updateUpperIntersectionObserver, set: (obj, value) => { obj.#updateUpperIntersectionObserver = value; } }, metadata: _metadata }, _private_updateUpperIntersectionObserver_initializers, _private_updateUpperIntersectionObserver_extraInitializers);
            __esDecorate(null, null, _private_updateLowerIntersectionObserver_decorators, { kind: "field", name: "#updateLowerIntersectionObserver", static: false, private: true, access: { has: obj => #updateLowerIntersectionObserver in obj, get: obj => obj.#updateLowerIntersectionObserver, set: (obj, value) => { obj.#updateLowerIntersectionObserver = value; } }, metadata: _metadata }, _private_updateLowerIntersectionObserver_initializers, _private_updateLowerIntersectionObserver_extraInitializers);
            __esDecorate(null, null, _private_updateUpperThreshold_decorators, { kind: "field", name: "#updateUpperThreshold", static: false, private: true, access: { has: obj => #updateUpperThreshold in obj, get: obj => obj.#updateUpperThreshold, set: (obj, value) => { obj.#updateUpperThreshold = value; } }, metadata: _metadata }, _private_updateUpperThreshold_initializers, _private_updateUpperThreshold_extraInitializers);
            __esDecorate(null, null, _private_updateLowerThreshold_decorators, { kind: "field", name: "#updateLowerThreshold", static: false, private: true, access: { has: obj => #updateLowerThreshold in obj, get: obj => obj.#updateLowerThreshold, set: (obj, value) => { obj.#updateLowerThreshold = value; } }, metadata: _metadata }, _private_updateLowerThreshold_initializers, _private_updateLowerThreshold_extraInitializers);
            if (_metadata) Object.defineProperty(this, Symbol.metadata, { enumerable: true, configurable: true, writable: true, value: _metadata });
        }
        #dom = __runInitializers(this, _instanceExtraInitializers);
        #enableScrollEnd = false;
        #debounceScrollForMockingScrollEnd;
        #prevX = 0;
        #prevY = 0;
        constructor(dom) {
            this.#dom = dom;
        }
        #getScrollContainer = () => this.#dom;
        #getUpperThresholdObserverDom = genDomGetter(() => this.#dom.shadowRoot, '#upper-threshold-observer');
        #getLowerThresholdObserverDom = genDomGetter(() => this.#dom.shadowRoot, '#lower-threshold-observer');
        #handleObserver = (entries) => {
            const { isIntersecting, target } = entries[0];
            const id = target.id;
            if (isIntersecting) {
                if (id === 'upper-threshold-observer') {
                    this.#dom.dispatchEvent(new CustomEvent('scrolltoupper', {
                        ...commonComponentEventSetting,
                        detail: this.#getScrollDetail(),
                    }));
                }
                else if (id === 'lower-threshold-observer') {
                    this.#dom.dispatchEvent(new CustomEvent('scrolltolower', {
                        ...commonComponentEventSetting,
                        detail: this.#getScrollDetail(),
                    }));
                }
            }
        };
        static observedAttributes = [
            'x-enable-scrolltoupper-event',
            'x-enable-scrolltolower-event',
            'x-enable-scroll-event',
            'x-enable-scrollend-event',
            'upper-threshold',
            'lower-threshold',
        ];
        #updateUpperIntersectionObserver = __runInitializers(this, _private_updateUpperIntersectionObserver_initializers, bindToIntersectionObserver(this.#getScrollContainer, this.#getUpperThresholdObserverDom, this.#handleObserver));
        #updateLowerIntersectionObserver = (__runInitializers(this, _private_updateUpperIntersectionObserver_extraInitializers), __runInitializers(this, _private_updateLowerIntersectionObserver_initializers, bindToIntersectionObserver(this.#getScrollContainer, this.#getLowerThresholdObserverDom, this.#handleObserver)));
        #updateUpperThreshold = (__runInitializers(this, _private_updateLowerIntersectionObserver_extraInitializers), __runInitializers(this, _private_updateUpperThreshold_initializers, bindToStyle(this.#getUpperThresholdObserverDom, 'flex-basis', (v) => `${parseInt(v)}px`)));
        #updateLowerThreshold = (__runInitializers(this, _private_updateUpperThreshold_extraInitializers), __runInitializers(this, _private_updateLowerThreshold_initializers, bindToStyle(this.#getLowerThresholdObserverDom, 'flex-basis', (v) => `${parseInt(v)}px`)));
        #getScrollDetail() {
            let { scrollTop, scrollLeft, scrollHeight, scrollWidth } = this
                .#getScrollContainer();
            if (scrollTop === 0) {
                scrollTop -= this.#dom.scrollHeight / 2 - this.#dom.scrollTop;
            }
            if (scrollLeft === 0) {
                scrollLeft -= this.#dom.scrollWidth / 2 - this.#dom.scrollLeft;
            }
            const detail = {
                scrollTop,
                scrollLeft,
                scrollHeight,
                scrollWidth,
                isDragging: false,
                deltaX: scrollLeft - this.#prevX,
                deltaY: scrollTop - this.#prevY,
            };
            this.#prevX = scrollLeft;
            this.#prevY = scrollTop;
            return detail;
        }
        #handleScroll = (__runInitializers(this, _private_updateLowerThreshold_extraInitializers), () => {
            if (this.#enableScrollEnd && !useScrollEnd) {
                // debounce
                clearTimeout(this.#debounceScrollForMockingScrollEnd);
                this.#debounceScrollForMockingScrollEnd = setTimeout(() => {
                    this.#handleScrollEnd();
                }, 100);
            }
            this.#dom.dispatchEvent(new CustomEvent('lynxscroll', {
                ...commonComponentEventSetting,
                detail: this.#getScrollDetail(),
            }));
        });
        #handleScrollEnd = () => {
            this.#dom.dispatchEvent(new CustomEvent('lynxscrollend', {
                ...commonComponentEventSetting,
                detail: this.#getScrollDetail(),
            }));
        };
        get #handleScrollEventsSwitches() { return _private_handleScrollEventsSwitches_descriptor.value; }
        connectedCallback() { }
        dispose() { }
    };
})();
export { ScrollViewEvents };
//# sourceMappingURL=ScrollViewEvents.js.map