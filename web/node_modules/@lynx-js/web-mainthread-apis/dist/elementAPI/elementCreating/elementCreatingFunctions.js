// Copyright 2023 The Lynx Authors. All rights reserved.
// Licensed under the Apache License Version 2.0 that can be found in the
// LICENSE file in the root directory of this source tree.
import { cssIdAttribute, parentComponentUniqueIdAttribute, } from '@lynx-js/web-constants';
import { __UpdateComponentID } from '../attributeAndProperty/attributeAndPropertyFunctions.js';
import { ListElement, ElementThreadElement, } from '../ElementThreadElement.js';
import { __SetCSSId } from '../style/styleFunctions.js';
import { createOffscreenDocument } from '../createOffscreenDocument.js';
export function initializeElementCreatingFunction(config) {
    const tagSet = new Set();
    const { operationsRef, pageConfig, styleInfo } = config;
    const document = createOffscreenDocument({
        pageConfig,
        operationsRef,
        styleInfo,
    });
    function createLynxElement(tag, parentComponentUniqueId, cssId, componentId, 
    // @ts-expect-error
    info) {
        if (!tagSet.has(tag)) {
            config.onNewTag(tag);
            tagSet.add(tag);
        }
        const element = document.createElement(tag);
        // element.parentComponentUniqueId = parentComponentUniqueId;
        element.setAttribute(parentComponentUniqueIdAttribute, parentComponentUniqueId.toString());
        if (cssId !== undefined)
            __SetCSSId([element], cssId);
        else if (parentComponentUniqueId >= 0) { // don't infer for uniqueid === -1
            const parentComponent = ElementThreadElement.getElementByUniqueId(parentComponentUniqueId);
            const parentCssId = parentComponent?.getAttribute(cssIdAttribute);
            if (parentCssId && parentCssId !== '0') {
                __SetCSSId([element], parentCssId);
            }
        }
        if (componentId !== undefined) {
            __UpdateComponentID(element, componentId);
        }
        return element;
    }
    function __CreateComponent(componentParentUniqueID, componentID, cssID, 
    // @ts-expect-error
    entryName, name, 
    // @ts-expect-error
    path, config, 
    // @ts-expect-error
    info) {
        const element = createLynxElement('view', componentParentUniqueID, cssID, componentID, config);
        element.setAttribute('name', name);
        return element;
    }
    function __CreateElement(tagName, parentComponentUniqueId, info) {
        return createLynxElement(tagName, parentComponentUniqueId, undefined, undefined, info);
    }
    function __CreatePage(componentID, cssID, info) {
        const page = createLynxElement('page', 0, cssID, componentID, info);
        page.setAttribute(parentComponentUniqueIdAttribute, page.uniqueId.toString());
        return page;
    }
    function __CreateView(parentComponentUniqueId) {
        const element = createLynxElement('view', parentComponentUniqueId);
        return element;
    }
    function __CreateText(parentComponentUniqueId) {
        const element = createLynxElement('text', parentComponentUniqueId);
        return element;
    }
    function __CreateRawText(text) {
        const element = createLynxElement('raw-text', -1);
        element.setAttribute('text', text);
        return element;
    }
    function __CreateImage(parentComponentUniqueId) {
        const element = createLynxElement('image', parentComponentUniqueId);
        return element;
    }
    function __CreateScrollView(parentComponentUniqueId) {
        const element = createLynxElement('scroll-view', parentComponentUniqueId);
        return element;
    }
    function __CreateWrapperElement(parentComponentUniqueId) {
        const element = createLynxElement('lynx-wrapper', parentComponentUniqueId);
        return element;
    }
    function __CreateList(parentComponentUniqueId, componentAtIndex, enqueueComponent, info) {
        const element = createLynxElement('list', parentComponentUniqueId, undefined, undefined, info);
        element.componentAtIndex = componentAtIndex;
        element.enqueueComponent = enqueueComponent;
        return element;
    }
    return {
        __CreateView,
        __CreateText,
        __CreateComponent,
        __CreatePage,
        __CreateRawText,
        __CreateImage,
        __CreateScrollView,
        __CreateElement,
        __CreateWrapperElement,
        __CreateList,
    };
}
//# sourceMappingURL=elementCreatingFunctions.js.map